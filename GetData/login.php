<?php 

	if (isset($_POST['Username']) && isset($_POST['Password']) && isset($_POST['Url'])) {
		$Account= $_POST['Username'];
		$Key= $_POST['Password'];
		$Url=$_POST['Url'];
	}

	
	
	//echo login("http://115.146.127.72/cmcsoft.iu.web.info/Login.aspx", "__EVENTTARGET=&__EVENTARGUMENT=&__LASTFOCUS=&__VIEWSTATE=%2FwEPDwUKMTkwNDg4MTQ5MQ9kFgICAQ9kFgpmD2QWCgIBDw8WAh4EVGV4dAUjSOG7jEMgVknhu4ZOIEvhu7ggVEhV4bqsVCBN4bqsVCBNw4NkZAICD2QWAmYPDxYEHwAFDcSQxINuZyBuaOG6rXAeEENhdXNlc1ZhbGlkYXRpb25oZGQCAw8QDxYGHg1EYXRhVGV4dEZpZWxkBQZreWhpZXUeDkRhdGFWYWx1ZUZpZWxkBQJJRB4LXyFEYXRhQm91bmRnZBAVAgJWTgJFThUCIEU0MzI5NkM2RjI0QzQ0MTBBODk0RjQ2RDU3RDJEM0FCIEFCQUY0NkJENjcxMjQ3QzVCNUI1Mjg4NUJCMkY5QzQ5FCsDAmdnFgFmZAIEDw8WAh4ISW1hZ2VVcmwFKC9DTUNTb2Z0LklVLldlYi5JbmZvL0ltYWdlcy9Vc2VySW5mby5naWZkZAIFD2QWBgIBDw8WAh8ABQZLaMOhY2hkZAIDDw8WAh8AZWRkAgcPDxYCHgdWaXNpYmxlaGRkAgIPZBYEAgMPD2QWAh4Gb25ibHVyBQptZDUodGhpcyk7ZAIHDw8WAh8ABS9C4bqhbiDEkcOjIG5o4bqtcCBzYWkgdMOqbiBob%2BG6t2MgbeG6rXQga2jhuql1IWRkAgQPDxYCHwZoZBYCAgEPFgIeC18hSXRlbUNvdW50Av%2F%2F%2F%2F8PZAIGDw8WAh8GaGQWBgIBDw9kFgIfBwUKbWQ1KHRoaXMpO2QCBQ8PZBYCHwcFCm1kNSh0aGlzKTtkAgkPD2QWAh8HBQptZDUodGhpcyk7ZAILD2QWCGYPDxYCHwBlZGQCAQ9kFgJmDw8WAh8BaGRkAgIPZBYCZg8PFgQfAAUNxJDEg25nIG5o4bqtcB8BaGRkAgMPDxYCHwAFtAU8YSBocmVmPSIjIiBvbmNsaWNrPSJqYXZhc2NyaXB0OndpbmRvdy5wcmludCgpIj48ZGl2IHN0eWxlPSJGTE9BVDpsZWZ0Ij4JPGltZyBzcmM9Ii9DTUNTb2Z0LklVLldlYi5JbmZvL2ltYWdlcy9wcmludC5wbmciIGJvcmRlcj0iMCI%2BPC9kaXY%2BPGRpdiBzdHlsZT0iRkxPQVQ6bGVmdDtQQURESU5HLVRPUDo2cHgiPkluIHRyYW5nIG7DoHk8L2Rpdj48L2E%2BPGEgaHJlZj0ibWFpbHRvOj9zdWJqZWN0PUhlIHRob25nIHRob25nIHRpbiBJVSZhbXA7Ym9keT1odHRwOi8vMTE1LjE0Ni4xMjcuNzIvY21jc29mdC5pdS53ZWIuaW5mby9Mb2dpbi5hc3B4Ij48ZGl2IHN0eWxlPSJGTE9BVDpsZWZ0Ij48aW1nIHNyYz0iL0NNQ1NvZnQuSVUuV2ViLkluZm8vaW1hZ2VzL3NlbmRlbWFpbC5wbmciICBib3JkZXI9IjAiPjwvZGl2PjxkaXYgc3R5bGU9IkZMT0FUOmxlZnQ7UEFERElORy1UT1A6NnB4Ij5H4butaSBlbWFpbCB0cmFuZyBuw6B5PC9kaXY%2BPC9hPjxhIGhyZWY9IiMiIG9uY2xpY2s9ImphdmFzY3JpcHQ6YWRkZmF2KCkiPjxkaXYgc3R5bGU9IkZMT0FUOmxlZnQiPjxpbWcgc3JjPSIvQ01DU29mdC5JVS5XZWIuSW5mby9pbWFnZXMvYWRkdG9mYXZvcml0ZXMucG5nIiAgYm9yZGVyPSIwIj48L2Rpdj48ZGl2IHN0eWxlPSJGTE9BVDpsZWZ0O1BBRERJTkctVE9QOjZweCI%2BVGjDqm0gdsOgbyDGsGEgdGjDrWNoPC9kaXY%2BPC9hPmRkZAxC9XE4siMOTk8wf3mq4A6hFfMjUaonzpfOMm3GHO1o&__VIEWSTATEGENERATOR=D620498B&PageHeader1%24drpNgonNgu=E43296C6F24C4410A894F46D57D2D3AB&PageHeader1%24hidisNotify=0&PageHeader1%24hidValueNotify=.&txtUserName=".$Account."&txtPassword=".$Key."&btnSubmit=%C4%90%C4%83ng+nh%E1%BA%ADp&hidUserId=&hidUserFullName=&hidTrainingSystemId=");

	login("http://115.146.127.72/CMCSoft.IU.Web.Info/Login.aspx", "__EVENTTARGET=&__EVENTARGUMENT=&__LASTFOCUS=&__VIEWSTATE=%2FwEPDwUKMTkwNDg4MTQ5MQ9kFgICAQ9kFgpmD2QWCgIBDw8WAh4EVGV4dAUjSOG7jEMgVknhu4ZOIEvhu7ggVEhV4bqsVCBN4bqsVCBNw4NkZAICD2QWAmYPDxYEHwAFDcSQxINuZyBuaOG6rXAeEENhdXNlc1ZhbGlkYXRpb25oZGQCAw8QDxYGHg1EYXRhVGV4dEZpZWxkBQZreWhpZXUeDkRhdGFWYWx1ZUZpZWxkBQJJRB4LXyFEYXRhQm91bmRnZBAVAgJWTgJFThUCIEU0MzI5NkM2RjI0QzQ0MTBBODk0RjQ2RDU3RDJEM0FCIEFCQUY0NkJENjcxMjQ3QzVCNUI1Mjg4NUJCMkY5QzQ5FCsDAmdnFgFmZAIEDw8WAh4ISW1hZ2VVcmwFKC9DTUNTb2Z0LklVLldlYi5JbmZvL0ltYWdlcy9Vc2VySW5mby5naWZkZAIFD2QWBgIBDw8WAh8ABQZLaMOhY2hkZAIDDw8WAh8AZWRkAgcPDxYCHgdWaXNpYmxlaGRkAgIPZBYEAgMPD2QWAh4Gb25ibHVyBQptZDUodGhpcyk7ZAIHDw8WAh8ABS9C4bqhbiDEkcOjIG5o4bqtcCBzYWkgdMOqbiBob%2BG6t2MgbeG6rXQga2jhuql1IWRkAgQPDxYCHwZoZBYCAgEPFgIeC18hSXRlbUNvdW50Av%2F%2F%2F%2F8PZAIGDw8WAh8GaGQWBgIBDw9kFgIfBwUKbWQ1KHRoaXMpO2QCBQ8PZBYCHwcFCm1kNSh0aGlzKTtkAgkPD2QWAh8HBQptZDUodGhpcyk7ZAILD2QWCGYPDxYCHwBlZGQCAQ9kFgJmDw8WAh8BaGRkAgIPZBYCZg8PFgQfAAUNxJDEg25nIG5o4bqtcB8BaGRkAgMPDxYCHwAFtAU8YSBocmVmPSIjIiBvbmNsaWNrPSJqYXZhc2NyaXB0OndpbmRvdy5wcmludCgpIj48ZGl2IHN0eWxlPSJGTE9BVDpsZWZ0Ij4JPGltZyBzcmM9Ii9DTUNTb2Z0LklVLldlYi5JbmZvL2ltYWdlcy9wcmludC5wbmciIGJvcmRlcj0iMCI%2BPC9kaXY%2BPGRpdiBzdHlsZT0iRkxPQVQ6bGVmdDtQQURESU5HLVRPUDo2cHgiPkluIHRyYW5nIG7DoHk8L2Rpdj48L2E%2BPGEgaHJlZj0ibWFpbHRvOj9zdWJqZWN0PUhlIHRob25nIHRob25nIHRpbiBJVSZhbXA7Ym9keT1odHRwOi8vMTE1LjE0Ni4xMjcuNzIvQ01DU29mdC5JVS5XZWIuSW5mby9Mb2dpbi5hc3B4Ij48ZGl2IHN0eWxlPSJGTE9BVDpsZWZ0Ij48aW1nIHNyYz0iL0NNQ1NvZnQuSVUuV2ViLkluZm8vaW1hZ2VzL3NlbmRlbWFpbC5wbmciICBib3JkZXI9IjAiPjwvZGl2PjxkaXYgc3R5bGU9IkZMT0FUOmxlZnQ7UEFERElORy1UT1A6NnB4Ij5H4butaSBlbWFpbCB0cmFuZyBuw6B5PC9kaXY%2BPC9hPjxhIGhyZWY9IiMiIG9uY2xpY2s9ImphdmFzY3JpcHQ6YWRkZmF2KCkiPjxkaXYgc3R5bGU9IkZMT0FUOmxlZnQiPjxpbWcgc3JjPSIvQ01DU29mdC5JVS5XZWIuSW5mby9pbWFnZXMvYWRkdG9mYXZvcml0ZXMucG5nIiAgYm9yZGVyPSIwIj48L2Rpdj48ZGl2IHN0eWxlPSJGTE9BVDpsZWZ0O1BBRERJTkctVE9QOjZweCI%2BVGjDqm0gdsOgbyDGsGEgdGjDrWNoPC9kaXY%2BPC9hPmRkZMzDHc34JphFQ1WKtfHKVDcgzGRMtW8EHDdbDkeWRKKl&__VIEWSTATEGENERATOR=D620498B&PageHeader1%24drpNgonNgu=E43296C6F24C4410A894F46D57D2D3AB&PageHeader1%24hidisNotify=0&PageHeader1%24hidValueNotify=.&txtUserName=".$Account."&txtPassword=".$Key."&btnSubmit=%C4%90%C4%83ng+nh%E1%BA%ADp&hidUserId=&hidUserFullName=&hidTrainingSystemId=");



	echo grab_page("http://115.146.127.72/CMCSoft.IU.Web.Info".$Url);
	
	function login($url, $data){
		$login= curl_init();
		curl_setopt($login, CURLOPT_COOKIEJAR, "/tmp/cookie");
		curl_setopt($login, CURLOPT_RETURNTRANSFER, true);
		curl_setopt($login, CURLOPT_TIMEOUT,40000);   
		curl_setopt($login, CURLOPT_URL, $url);  // url đăng nhập
		curl_setopt($login, CURLOPT_USERAGENT, $_SERVER['HTTP_USER_AGENT']);   // Giả lập trình duyệt
		curl_setopt($login, CURLOPT_FOLLOWLOCATION, true ); 
		curl_setopt($login, CURLOPT_POST, true);
		curl_setopt($login, CURLOPT_POSTFIELDS, $data);   // Điền dl dạng raw vào post
		curl_setopt($login, CURLOPT_SSL_VERIFYHOST, false);
		curl_setopt($login, CURLOPT_SSL_VERIFYPEER, false);
		ob_start();
		return curl_exec($login);
		ob_end_clean();
		curl_close($login);
		unset($login);
	}

	function grab_page($site){
		$ch= curl_init();
		curl_setopt($ch, CURLOPT_COOKIEFILE, "/tmp/cookie"); // Lưu cookie
		curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
		curl_setopt($ch, CURLOPT_TIMEOUT,40000);
		curl_setopt($ch, CURLOPT_URL, $site);  // url 
		curl_setopt($ch, CURLOPT_USERAGENT, $_SERVER['HTTP_USER_AGENT']);   // Giả lập trình duyệt
		curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true ); 
		curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
		curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
		ob_start();

		if (curl_error($ch)) {
    		 echo curl_error($ch);
		}
		return curl_exec($ch);
		
		ob_end_clean();
		curl_close($ch);
	}

	
?>





